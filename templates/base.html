{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TravelScout AI{% endblock title %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="antialiased text-gray-900 bg-white">
{% if request.resolver_match.url_name != 'home' and request.resolver_match.url_name != 'account_signup' and request.resolver_match.url_name != 'account_login' and request.resolver_match.url_name != 'trip_new' %}

    <!-- Navbar -->
    <!-- Navbar (Original Style + Menu + Dropdown) -->
    <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-2xl border-b border-gray-200/50"
         x-data="{ profileOpen: false }"> <!-- 1. Alpine.js state qo'shildi -->

        <div class="max-w-[1600px] mx-auto px-6 lg:px-12 py-4 flex items-center justify-between relative">

            <!-- A. LOGO -->
            <a href="{% if user.is_authenticated %}{% url 'my_plans_list' %}{% else %}{% url 'home' %}{% endif %}"
   <a href="{% url 'home' %}" class="flex items-center gap-2 group">
          <div class="relative">
            <div class="absolute inset-0 bg-gradient-to-r from-orange-500 via-rose-500 to-violet-500 blur-lg opacity-40 group-hover:opacity-60 transition-opacity"></div>
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-violet-600 relative">
              <path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8l-8.2 8.2"></path>
              <path d="m2 2 7.5 7.5"></path>
              <path d="M11 11 8 8"></path>
            </svg>
          </div>
          <span class="text-2xl font-bold bg-gradient-to-r from-orange-600 via-rose-600 to-violet-600 bg-clip-text text-transparent">TravelScout</span>
        </a>
</a>
            <!-- B. ORTA LINKLAR (Flights, Stories, Support) -->
            <!-- hidden md:flex = telefonda ko'rinmaydi, kompyuterda ko'rinadi -->
            <!-- ORTA LINKLAR (Floating Dock Style) -->
<div class="hidden md:flex items-center absolute left-1/2 -translate-x-1/2">

    <!-- Orqa fon (Dock Container) -->
    <div class="flex items-center gap-1 p-1.5 bg-gray-100/50 backdrop-blur-md border border-gray-200/60 rounded-full shadow-sm">

        <!-- 1. DASHBOARD -->
        <a href="{% url 'my_plans_list' %}"
           class="px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ease-out
           {% if request.resolver_match.url_name == 'my_plans_list' %}
               bg-white text-orange-600 shadow-[0_2px_8px_rgba(249,115,22,0.15)] ring-1 ring-black/5
           {% else %}
               text-gray-500 hover:text-gray-900 hover:bg-white/60
           {% endif %}">
           Dashboard
        </a>

        <!-- 2. FLIGHT FINDER -->
        <a href="{% url 'flight_search' %}"
           class="px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ease-out
           {% if request.resolver_match.url_name == 'flight_search' %}
               bg-white text-orange-600 shadow-[0_2px_8px_rgba(249,115,22,0.15)] ring-1 ring-black/5
           {% else %}
               text-gray-500 hover:text-gray-900 hover:bg-white/60
           {% endif %}">
           Flights
        </a>

        <!-- 3. STORIES -->
        <a href="{% url 'stories_feed' %}"
   class="px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ease-out
   {% if request.resolver_match.url_name == 'stories_feed' or request.resolver_match.url_name == 'story_detail' or request.resolver_match.url_name == 'trip_detail' %}
       {# AGAR: Stories Listda YOKI Story Detailda bo'lsak -> OQ FON (Liquid Effect) #}
       bg-white text-orange-600 shadow-[0_2px_8px_rgba(249,115,22,0.15)] ring-1 ring-black/5
   {% else %}
       {# Boshqa payt -> Oddiy kulrang #}
       text-gray-500 hover:text-gray-900 hover:bg-white/60
   {% endif %}">
   Stories
</a>
        <!-- 4. SUPPORT -->
        <!-- 4. SUPPORT -->
<a href="{% url 'support' %}"
   class="px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ease-out
   {% if request.resolver_match.url_name == 'support' %}
       {# Agar Support sahifasida bo'lsak: OQ FON va SOYA #}
       bg-white text-orange-600 shadow-[0_2px_8px_rgba(249,115,22,0.15)] ring-1 ring-black/5
   {% else %}
       {# Boshqa payt: Oddiy kulrang #}
       text-gray-500 hover:text-gray-900 hover:bg-white/60
   {% endif %}">
   Support
</a>
    </div>
</div>

            <!-- C. USER PROFILE (DROPDOWN BILAN) -->
            <div class="relative shrink-0">
                <!-- Tugma (Trigger) -->
                <button @click="profileOpen = !profileOpen"
                        @click.outside="profileOpen = false"
                        class="flex items-center gap-2 pl-2 pr-4 py-1.5 bg-gray-100/80 hover:bg-gray-200 rounded-full transition-all border border-transparent hover:border-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-200">

                    <!-- Avatar -->
<div class="w-9 h-9 rounded-full bg-gradient-to-br from-orange-400 to-rose-500 p-[2px]">
    <div class="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden">
        {% if user.profile.profile_picture %}
            <!-- Agar rasm bo'lsa, rasmni ko'rsat -->
            <img src="{{ user.profile.profile_picture.url }}" alt="{{ user.username }}" class="w-full h-full object-cover">
        {% else %}
            <!-- Rasm bo'lmasa, harfni ko'rsat -->
            <span class="font-bold text-sm text-rose-600">{{ user.username|slice:":1"|upper }}</span>
        {% endif %}
    </div>
</div>

                    <!-- Ism -->
                    <span class="text-gray-700 font-bold text-sm">{{ user.username }}</span>

                    <!-- Pastga qaragan strelka -->
                    <svg class="w-4 h-4 text-gray-400 transition-transform duration-200" :class="profileOpen ? 'rotate-180' : ''" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                </button>

                <!-- DROPDOWN MENU (Ochiladigan oyna) -->
                <div x-show="profileOpen"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 translate-y-2"
                     class="absolute right-0 mt-3 w-56 bg-white rounded-2xl shadow-xl border border-gray-100 py-2 z-50 overflow-hidden"
                     style="display: none;">

                    <!-- Header qismi -->
                    <div class="px-4 py-3 border-b border-gray-50">
                        <p class="text-sm text-gray-500">Signed in as</p>
                        <p class="text-sm font-bold text-gray-900 truncate">{{ user.email|default:user.username }}</p>
                    </div>

                    <!-- Menu itemlari -->
                    <!-- Navbar ichidagi Dropdown menyu qismida -->
<a href="{% url 'my_plans_list' %}?action=profile"

   {% if request.resolver_match.url_name == 'my_plans_list' %}
       {# Agar biz allaqachon Dashboardda bo'lsak, linkka o'tma, shunchaki signal ber #}
       @click.prevent="$dispatch('open-profile-modal')"
   {% endif %}

   class="block px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-orange-50 hover:text-orange-600 transition-colors flex items-center gap-2">

    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    My Profile
</a>

                    <!-- Bu yerga xohlagan boshqa linklarni qo'shishingiz mumkin -->
                    <!-- Masalan: Settings, Billing va h.k. -->

                    <div class="border-t border-gray-50 my-1"></div>

                    <!-- Log Out Button -->
                    <!-- Eslatma: 'logout' degan url name sizning urls.py da bo'lishi kerak -->
                    <form method="post" action="{% url 'logout' %}">
                        {% csrf_token %}
                        <button type="submit" class="w-full text-left px-4 py-2.5 text-sm font-bold text-red-500 hover:bg-red-50 transition-colors flex items-center gap-2">
                            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            Log Out
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </nav>
{% endif %}
    <main>

        {% block content %}
        {% endblock content %}
    </main>

    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 800,
            once: true,
        });
    </script>
</body>
</html>