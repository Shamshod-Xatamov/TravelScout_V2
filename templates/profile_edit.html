{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - TravelScout{% endblock title %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-orange-50 via-rose-50 to-violet-50 flex items-center justify-center p-6 font-sans">

    <!-- Navbar (Back button) -->
    <nav class="fixed top-0 left-0 right-0 z-50 p-6">
        <a href="{% url 'my_plans_list' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-xl rounded-full shadow-sm hover:shadow-md transition-all text-gray-700 font-bold">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Back to Dashboard
        </a>
    </nav>

    <!-- Main Card -->
    <div class="w-full max-w-xl bg-white/80 backdrop-blur-2xl rounded-[40px] shadow-2xl border border-white/50 overflow-hidden relative p-8 md:p-12">

        <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">Edit Profile</h1>

        <!-- ENCTYPE juda muhim, rasmni jo'natish uchun -->
        <form method="post" enctype="multipart/form-data" class="space-y-8">
            {% csrf_token %}

            <!-- Profile Picture Upload Section -->
            <div class="flex flex-col items-center gap-4">
                <div class="relative group cursor-pointer">
                    <!-- Rasm konteyneri -->
                    <div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg relative">
                        <!-- Preview Image (JS orqali o'zgaradi) -->
                        <img id="profile-preview"
                             src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}https://ui-avatars.com/api/?name={{ user.username }}&background=random{% endif %}"
                             class="w-full h-full object-cover transition-all group-hover:blur-sm">

                        <!-- Overlay Icon -->
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>
                        </div>
                    </div>

                    <!-- Asl Input (Yashirin) -->
                    {{ p_form.profile_picture }}

                    <!-- Label (Inputni bosish uchun) -->
                    <label for="file-upload" class="absolute inset-0 rounded-full cursor-pointer"></label>
                </div>
                <p class="text-sm text-gray-500 font-medium">Tap image to change</p>
            </div>

            <!-- Inputs -->
            <div class="space-y-4">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Username</label>
                    <input type="text" name="username" value="{{ user.username }}" class="w-full px-5 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 outline-none transition-all font-medium">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-wide ml-1">Email Address</label>
                    <input type="email" name="email" value="{{ user.email }}" class="w-full px-5 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 outline-none transition-all font-medium">
                </div>
            </div>

            <!-- Buttons -->
            <div class="flex flex-col gap-3 pt-4">
                <button type="submit" class="w-full py-4 bg-gradient-to-r from-orange-500 via-rose-500 to-violet-600 text-white rounded-xl font-bold text-lg shadow-xl hover:scale-[1.02] transition-all">
                    Save Changes
                </button>

                <!-- Password Change (Link) -->
                <a href="#" class="w-full py-3.5 bg-white border border-gray-200 text-gray-600 rounded-xl font-bold text-center hover:bg-gray-50 transition-all text-sm">
                    Change Password
                </a>
            </div>
        </form>
    </div>
</div>

<!-- JAVASCRIPT: Rasmni tanlaganda darrov ko'rsatish uchun -->
<script>
    const fileInput = document.getElementById('file-upload');
    const previewImg = document.getElementById('profile-preview');

    fileInput.onchange = evt => {
        const [file] = fileInput.files;
        if (file) {
            previewImg.src = URL.createObjectURL(file);
        }
    }
</script>
{% endblock content %}